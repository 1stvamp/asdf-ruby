#!/usr/bin/env bash

current_file="$1"
basename=$(basename -- "$current_file")

if [ "$basename" == "Gemfile" ]; then
  RUBY_VERSION=$(grep '^\s*ruby' "$current_file" |
    sed -e 's/[[:space:]]/ /g' -e 's/#.*//' \
    -e 's/engine:/:engine =>/' -e 's/engine_version:/:engine_version =>/' \
    -e "s/.*:engine *=> *['\"]\([^'\"]*\).*:engine_version *=> *['\"]\([^'\"]*\).*/\1-\2/" \
    -e "s/.*:engine_version *=> *['\"]\([^'\"]*\).*:engine *=> *['\"]\([^'\"]*\).*/\2-\1/" \
    -e "s/ *ruby *['\"]\([^'\"]*\).*/\1/" |
    head -1)
elif [ "$basename" == ".ruby-version" ]; then
  RUBY_VERSION=$(cat "$current_file")
fi

echo "$RUBY_VERSION"
exit
